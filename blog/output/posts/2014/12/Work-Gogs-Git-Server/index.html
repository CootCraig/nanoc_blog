<!DOCTYPE html>
<head>
  <meta charset='utf-8'>
  <title>
    Nanoc Blog
  </title>
  <link href='/stylesheet.css' rel='stylesheet'>
</head>
<body>
  <div id='banner'>
    Cootcraig Public Blog
  </div>
  <div id='main'>
    <div class='post'>
      <h1>Setup up work Git server with Gogs</h1>
      <div>
        <span>Post tags:</span>
        |
        <span><a href="/tags/debian">debian</a></span>
        |
        <span><a href="/tags/git">git</a></span>
        |
        <span><a href="/tags/gogs">gogs</a></span>
        |
        <span><a href="/tags/linux">linux</a></span>
        |
      </div>
      <article>
        
        <h1 id="setup-up-work-git-server-with-gogs">Setup up work Git server with Gogs</h1>
        
        <p>Install a Debian 7 virtualbox guest
        to host the company GIT repositories.</p>
        
        <h2 id="use-debian-stable-wheezy">Use Debian stable wheezy</h2>
        
        <p><a href="http://cdimage.debian.org/debian-cd/7.7.0/amd64/iso-cd/debian-7.7.0-amd64-netinst.iso">Debian 7.7 net install iso</a></p>
        
        <p>The current “stable” distribution of Debian is version 7, codenamed
        wheezy. It was initially released as version 7.0 on May 4th, 2013 and
        its latest update, version 7.7, was released on October 18th, 2014.</p>
        
        <h2 id="base-install">Base install</h2>
        
        <p>Hostname: gogs.gcsww.local</p>
        
        <pre><code>
        Software Selection
        ---------------------
        remove Debian desktop environment
        leave Print server
        Add SSH server
        remove laptop
        </code></pre>
        
        <pre><code>
        apt-get update
        apt-get dist-upgrade
        
        apt-get install vim
        apt-get install tmux
        apt-get install git
        apt-get install sudo
        
        adduser craig sudo
        </code></pre>
        
        <h2 id="put-local-ssh-public-key-on-gogs-server">Put local ssh public key on gogs server</h2>
        
        <ul>
          <li><a href="http://www.thegeekstuff.com/2008/11/3-steps-to-perform-ssh-login-without-password-using-ssh-keygen-ssh-copy-id/">ssh-copy-id instructions</a></li>
        </ul>
        
        <p>Step 2: Copy the public key to remote-host using ssh-copy-id</p>
        
        <pre><code>
        jsmith@local-host$ ssh-copy-id -i ~/.ssh/id_rsa.pub remote-host
        jsmith@remote-host's password:
        Now try logging into the machine, with "ssh 'remote-host'", and check in:
        
        .ssh/authorized_keys
        
        to make sure we haven't added extra keys that you weren't expecting.
        
        ssh-copy-id -i ~/.ssh/id_rsa.pub 192.168.88.183
        ssh 192.168.88.183
        </code></pre>
        
        <p>Note: ssh-copy-id appends the keys to the remote-host’s .ssh/authorized_key.</p>
        
        <h2 id="gogs-install-howto-for-debian-7-wheezyhttpspackagerioghpkgrgogsinstallbid131debian-7-gogs"><a href="https://packager.io/gh/pkgr/gogs/install?bid=131#debian-7-gogs">gogs Install Howto for Debian 7 Wheezy</a></h2>
        
        <h3 id="here-is-how-to-install-the-package-on-a-debian-7-wheezy-64bits-server">Here is how to install the package on a Debian 7 Wheezy 64bits server:</h3>
        <pre><code>
        ssh 192.168.88.183
        </code></pre>
        
        <p>https support was missing from apt-get after install</p>
        
        <pre><code>
        apt-get install apt-transport-https
        </code></pre>
        
        <p>Here is how to install the package on a Debian 7 Wheezy 64bits server:</p>
        
        <pre><code>
        wget -qO - https://deb.packager.io/key | sudo apt-key add -
        echo "deb https://deb.packager.io/gh/pkgr/gogs wheezy pkgr" | sudo tee /etc/apt/sources.list.d/gogs.list
        sudo apt-get update
        sudo apt-get install gogs
        
        The following NEW packages will be installed:
          gogs libevent-core-2.0-5 libevent-extra-2.0-5 libmysqlclient18 libpq5 libreadline5 libxslt1.1 mysql-common
        
        Setting up gogs (0.5.8-1418206274.9ee80e3.wheezy) ...
        Scaling up...
        update-rc.d: using dependency based boot sequencing
        update-rc.d: using dependency based boot sequencing
        update-rc.d: using dependency based boot sequencing
        gogs-web-1 started.
        --&gt; done.
        </code></pre>
        
        <pre><code>
        APP_NAME="gogs"
        MYSQL_PASSWORD="change_me"
        HOSTNAME="example.com"
        
        debconf-set-selections &lt;&lt;CONFIG
        mysql-server-5.5 mysql-server/root_password password ${MYSQL_PASSWORD}
        mysql-server-5.5 mysql-server/root_password_again password ${MYSQL_PASSWORD}
        CONFIG
        </code></pre>
        
        <pre><code>
        APP_NAME="gogs"
        MYSQL_PASSWORD="change_me"
        HOSTNAME="example.com"
        
        apt-get install -y --force-yes mysql-server
        
        The following NEW packages will be installed:
          libaio1 libdbd-mysql-perl libdbi-perl libhtml-template-perl mysql-client-5.5 mysql-server mysql-server-5.5 mysql-server-core-5.5
        </code></pre>
        
        <pre><code>
        APP_NAME="gogs"
        MYSQL_PASSWORD="change_me"
        HOSTNAME="example.com"
        
        mysql -uroot -p${MYSQL_PASSWORD} -e "create database if not exists ${APP_NAME};"
        </code></pre>
        
        <pre><code>
        apt-get install -y nginx
        
        The following NEW packages will be installed:
          nginx nginx-common nginx-full
        </code></pre>
        
        <pre><code>
        APP_NAME="gogs"
        MYSQL_PASSWORD="change_me"
        HOSTNAME="example.com"
        
        cat &gt; /etc/nginx/sites-available/default &lt;&lt;EOF
        server {
          listen          80;
          server_name     ${HOSTNAME} "";
          location / {
            proxy_pass      http://localhost:6000;
          }
        }
        EOF
        </code></pre>
        
        <pre><code>
        sudo service nginx restart
        </code></pre>
        
        <p>Now, access http://${HOSTNAME} and finish the installation process. Easy!</p>
        <pre><code>
        http://10.10.9.186/craig/game_justin_craig_20141209
        
        git remote add origin http://localhost:6000/craig/game_justin_craig_20141209.git
        git push -u origin master
        </code></pre>
        
        <ul>
          <li><a href="https://www.kernel.org/pub/software/scm/git/docs/git-push.html#URLS">Git URLs</a></li>
        </ul>
        
        <pre><code>
        was
        origin	/media/gcs3f/GIT/game_justin_craig_20141209.git 
        
        git remote set-url origin http://10.10.9.186/craig/game_justin_craig_20141209
        
        
        ssh://[user@]host.xz[:port]/path/to/repo.git/ 
        gogs@localhost:craig/game_justin_craig_20141209.git
        
        git remote set-url origin craig@10.10.9.186:craig/game_justin_craig_20141209.git
        
        </code></pre>
        
        <h3 id="on-reboot-gogs-service-not-running">On reboot gogs service not running</h3>
        
        <h4 id="some-background-on-debian-boot-up-services">Some background on Debian boot up services</h4>
        
        <p><a href="http://www.jamescoyle.net/cheat-sheets/791-update-rc-d-cheat-sheet">update-rc.d Cheat Sheet - James Coyle</a></p>
        
        <pre><code>
        service --status-all
         ...
         [ ? ]  gogs
         [ ? ]  gogs-web
         [ - ]  gogs-web-1
         ...
        </code></pre>
        
        <ul>
          <li><a href="https://wiki.debian.org/LSBInitScripts/DependencyBasedBoot">LSBInitScripts DependencyBasedBoot</a></li>
          <li><a href="https://www.debian.org/doc/manuals/debian-reference/ch03.en.html">Chapter 3. The system initialization</a></li>
          <li><a href="https://wiki.debian.org/LSBInitScripts">How to LSBize an Init Script</a></li>
          <li><a href="https://wiki.debian.org/Daemon">Daemons in Debian</a></li>
          <li>
            <p><a href="https://packages.debian.org/wheezy/bootchart2">boot process performance analyser</a></p>
          </li>
          <li><a href="https://www.debian.org/releases/stable/i386/release-notes/ch-whats-new.en.html#dependency-boot">2.2.3. Dependency booting</a></li>
        </ul>
        
        <p>insserv is a low level tool used by update-rc.d which enables an installed
        system init script (boot script) by reading the comment header of the
        script, e.g.:</p>
        
        <p>The dependency-based boot sequencing introduced with Debian 6.0 is now
        always enabled, including for users of file-rc.</p>
        
        <p>For optimal sequencing, all init.d scripts should declare their
        dependencies in an LSB header. This is already the case for scripts
        shipped in Debian, but users should check their local scripts and consider
        adding that information.</p>
        
        <p>For more information on this feature refer to the information available
        in /usr/share/doc/insserv/README.Debian.</p>
        
        <p>Starting with Debian 6.0, the insserv command is used instead, if
        dependency-based booting is enabled:</p>
        
        <pre><code>
        insserv mydaemon
        </code></pre>
        
        <p>Where mydaemon is an executable init script placed in /etc/init.d. insserv
        will produce no output if everything went OK. Examine the error code in
         $? if you want to be sure.</p>
        
        <p>Both the old and the new way requires an init script to be present in
        /etc/init.d. For dependency-based booting, the script needs to be an
        LSB init script.</p>
        
        <h4 id="lets-fix-it">Let’s fix it</h4>
        
        <pre><code>
        /etc/init.d/gogs
        /etc/init.d/gogs-web
        /etc/init.d/gogs-web-1
        </code></pre>
        
        <p>To see all the files the package installed onto your system, do this:</p>
        
        <pre><code>
        dpkg-query -L <package_name>
        
        
        <pre><code>
        /opt/gogs/conf/app.ini
        </code></pre>
        
        ## migrate existing
        
        * [Moving A Git Repository To A New Server - Nik Sumeiko](http://www.smashingmagazine.com/2014/05/19/moving-git-repository-new-server/)
        
        
        </package_name></code></pre>
      </article>
    </div>
  </div>
  <div id='sidebar'>
    <ul>
      <li><a href="/">Main</a></li>
      <li><a href="/post_index/">Posts</a></li>
      <li><a href="/tag_index/">Tags</a></li>
    </ul>
  </div>
</body>
