<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <title>
      Coot Craig Blog
      Raspbian netinst
    </title>
    <link href='/assets/app.css' rel='stylesheet'>
    <script src='/assets/modernizr.js'></script>
    <script src='/assets/jquery-2.0.3.min.js'></script>
    <script src='/assets/foundation.js'></script>
    <script src='/assets/foundation.topbar.js'></script>
  </head>
  <body>
    <div class='header'>
      <div class='contain-to-grid'>
        <nav class='top-bar'>
          <ul class='title-area'>
            <li class='name'>
              <a href='/'>Coot Craig Blog</a>
            </li>
            <li class='toggle-topbar menu-icon'>
              <a href='#'>
                <span>Menu</span>
              </a>
            </li>
          </ul>
          <section class='top-bar-section'>
            <ul class='left'></ul>
            <ul class='right'>
              <li>
                <a href='/blog/'>Blog</a>
              </li>
              <li>
                <a href='#'>Contact</a>
              </li>
            </ul>
          </section>
        </nav>
      </div>
    </div>
    <div class='row'>
      <div class='twelve columns'>
        <div class='post'>
          <h3>Raspbian netinst</h3>
          <aside>Posted on Wednesday, March 5 2014</aside>
          <article>
            <h2 id="net-installer-image">Net Installer Image</h2>
            
            <ul>
              <li><a href="http://hifi.iki.fi/raspbian-ua-netinst/raspbian-ua-netinst-latest.img.xz">raspbian-ua-netinst - image download</a></li>
              <li><a href="https://github.com/hifi/raspbian-ua-netinst">image link and instructions on github</a></li>
            </ul>
            
            <h2 id="notes">Notes</h2>
            
            <h3 id="to-flash-your-sd-card-on-linux">To flash your SD card on Linux:</h3>
            
            <pre><code>
            xzcat /path/to/raspbian-ua-netinst-latest.img.xz &gt; glop.img
            sudo dd bs=1M if= glop.img of=/dev/sdc
            rm glop.img
            </code></pre>
            
            <p>Boot with the SDHC and
            view the HDMI video to see install progress.</p>
            
            <h3 id="first-boot">First boot</h3>
            
            <p>The system is almost completely unconfigured on first boot. Here are
            some tasks you most definitely want to do on first boot.</p>
            
            <p>The default root password is raspbian.</p>
            
            <p>Set new root password: </p>
            
            <pre><code>
            passwd
            </code></pre>
            
            <p>Configure your default locale: </p>
            
            <pre><code>
            dpkg-reconfigure locales
            </code></pre>
            
            <p>Configure your timezone: </p>
            
            <pre><code>
            dpkg-reconfigure tzdata
            </code></pre>
            
            <p>Install latest kernel and firmware package: </p>
            
            <pre><code>
            apt-get update
            apt-get install linux-image-rpi-rpfv raspberrypi-bootloader-nokernel
            
             ...
            update-initramfs: Generating /boot/initrd.img-3.10-3-rpi
            </code></pre>
            
            <p>Replace old kernel.img with latest kernel: </p>
            
            <pre><code>
            cp /vmlinuz /boot/kernel.img
            </code></pre>
            
            <p>Reboot to new kernel and firmware: </p>
            
            <pre><code>
            reboot
            </code></pre>
            
            <h3 id="change-the-hostname">Change the hostname</h3>
            
            <p>Edit /etc/hostname and /etc/hosts to have the hostname.</p>
            
            <pre><code>
            root@pi:/etc# cat hostname
            pika
            root@pi:/etc# cat hosts
            127.0.0.1 localhost pika
            </code></pre>
            
            <h3 id="set-up-serial-console">Set up serial console</h3>
            
            <p>Edit /etc/inittab and add a line to enable the serial console.</p>
            
            <pre><code>
            #T0:23:respawn:/sbin/getty -L ttyS0 9600 vt100
            T0:23:respawn:/sbin/getty -L ttyAMA0 115200 vt100
            #T1:23:respawn:/sbin/getty -L ttyS1 9600 vt100
            </code></pre>
            
            <h3 id="after-a-reboot-check-the-serial-console-and-hostname">After a reboot, check the serial console and hostname.</h3>
            
            <pre><code>
            $ sudo screen /dev/ttyUSB0 115200
            </code></pre>
            
            <pre><code>
            root@pika:~# uname -a
            Linux pika 3.10-3-rpi #1 Debian 3.10.11-1+rpi4 (2014-01-24) armv6l GNU/Linux
            </code></pre>
            
            <p>ssh is working.  This is the IP address assigned to eth0</p>
            <pre><code>
            ssh root@192.168.88.223
            </code></pre>
            
            <h3 id="archive-the-image-so-far">Archive the image so far</h3>
            
            <p>Check the size of file systems.  Looks like the whole 8GB SDHC is used.</p>
            
            <pre><code>
            root@pika:~# df -k
            Filesystem     1K-blocks   Used Available Use% Mounted on
            rootfs           7399324 302888   6697524   5% /
            /dev/root        7399324 302888   6697524   5% /
            devtmpfs          224292      0    224292   0% /dev
            tmpfs              44876    116     44760   1% /run
            tmpfs               5120      0      5120   0% /run/lock
            tmpfs              89740      0     89740   0% /run/shm
            /dev/mmcblk0p1     48742  22956     25786  48% /boot
            tmpfs              89740      0     89740   0% /tmp
            </code></pre>
            
            <pre><code>
            $ sudo dd bs=1M if=/dev/sdc of=pika_20140305_0958.img
            $ 7za a -t7z pika_20140305_0958.img.7z pika_20140305_0958.img
            </code></pre>
            
            <h3 id="set-up-the-wifi-edimax-ew-7811un">set up the wifi Edimax EW-7811UN</h3>
            
            <p>I had problems, but got help here.</p>
            
            <p><a href="http://www.raspberrypi.org/forum/viewtopic.php?f=28&amp;t=71314">Post on raspberrypi.org forum - Where to get help on wifi?</a></p>
            
            <p>So I added 2 packages.</p>
            
            <pre><code>
            apt-get install wpasupplicant
            apt-get install wireless-tools
            </code></pre>
            
            <p>Here is the trail
            Verify the Edimax EW-7811Un is seen.</p>
            
            <pre><code>
            root@pika:~# lsusb
             ...
            Bus 001 Device 004: ID 7392:7811 Edimax Technology Co., Ltd EW-7811Un 802.11n Wireless Adapter [Realtek RTL8188CUS]
             ...
            </code></pre>
            
            <p>Note that the wpa-psk entry is not the passphrase.
            With the ssid and passphrase this site can give the psk.</p>
            
            <p><a href="http://www.wireshark.org/tools/wpa-psk.html">Wireshark - WPA PSK (Raw Key) Generator</a></p>
            
            <p>Here is the interfaces file.</p>
            
            <pre><code>
            root@pika:~# cat /etc/network/interfaces
            auto lo
            iface lo inet loopback
            
            auto eth0
            iface eth0 inet dhcp
            
            auto wlan0
            allow-hotplug wlan0
            iface wlan0 inet dhcp
              wpa-ssid Pirates
              wpa-psk alonghexstringpsk
            </code></pre>
            
            <p>See if iwlist from wireless-tools finds the router. </p>
            
            <pre><code>
            root@pika:~# iwlist wlan0 scan
            
            wlan0     Scan completed :
                      Cell 01 - Address: D4:CA:6D:56:86:59
                                ESSID:"Pirates"
                                Protocol:IEEE 802.11bgn
                                Mode:Master
                                Frequency:2.412 GHz (Channel 1)
                                Encryption key:on
                                Bit Rates:300 Mb/s
                                Extra:wpa_ie=dd1a0050f20101000050f20402000050f2040050f20201000050f202
                                IE: WPA Version 1
                                    Group Cipher : CCMP
                                    Pairwise Ciphers (2) : CCMP TKIP
                                    Authentication Suites (1) : PSK
                                Extra:rsn_ie=30160100000fac040200000fac04000fac020100000fac02
                                IE: IEEE 802.11i/WPA2 Version 1
                                    Group Cipher : CCMP
                                    Pairwise Ciphers (2) : CCMP TKIP
                                    Authentication Suites (1) : PSK
                                Quality=100/100  Signal level=100/100  
            </code></pre>
            
            <p>For the wifi interface</p>
            
            <pre><code>
            $ ssh craig@192.168.88.218
            </code></pre>
            
            <p>For the wired interface</p>
            
            <pre><code>
            $ ssh root@192.168.88.223
            </code></pre>
            
            <h3 id="add-a-user">add a user</h3>
            
            <pre><code>
            pika# adduser craig
            </code></pre>
            
            <h3 id="generate-a-key-pair-for-the-new-user">Generate a key pair for the new user</h3>
            
            <pre><code>
            $ ssh-keygen
            </code></pre>
            
            <h3 id="install-python-vim-tmux-git">Install python, vim, tmux, git</h3>
            
            <pre><code>
            pika# apt-get install python
             ...
            The following NEW packages will be installed:
              file libmagic1 libsqlite3-0 mime-support python python-minimal python2.7 python2.7-minimal
             ...
            
            pika# apt-get install vim tmux git
             ...
            The following NEW packages will be installed:
              git git-man libclass-isa-perl libcurl3-gnutls liberror-perl libevent-2.0-5 libgpm2 libldap-2.4-2 libpopt0 librtmp0 libsasl2-2 libsasl2-modules libssh2-1 libswitch-perl patch perl perl-modules rsync tmux vim vim-runtime
             ...
            </code></pre>
            
            <h3 id="personalize-git">Personalize git</h3>
            
            <pre><code>
            $ git config --global user.name "Your Name Here"
            Sets the default name for git to use when you commit
            
            $ git config --global user.email "your_email@example.com"
            Sets the default email for git to use when you commit
            </code></pre>
            
            <h3 id="set-up-the-vim-dotfiles-and-vundle">Set up the vim dotfiles and vundle.</h3>
            
            <pre><code>
            $ git clone git@github.com:CootCraig/dotfiles_again.git
            
            $ cd dotfiles_again/linux
            $ bash ./install.sh 
            
            cd ~/dotfiles_again/windows/vimfiles/bundle
            git clone https://github.com/gmarik/vundle.git
            </code></pre>
            
            <p>There are some notes on using vundle in the file ~/.vim/bundle/Readme.txt
            The Raspbian vim does not have python support, so disable UltiSnips
            vim script.  Comment out the following line in ~/.vimrc</p>
            
            <pre><code>
            Bundle 'vim-scripts/UltiSnips'
              to
            "Bundle 'vim-scripts/UltiSnips'
            </code></pre>
            
            <p>And then run BundleInstall.</p>
            
            <pre><code>
            in vim. :BundleInstall
            </code></pre>
            
            <h3 id="password-less-ssh">password less ssh</h3>
            
            <p>These instructions worked fine.</p>
            
            <p><a href="https://www.debian.org/devel/passwordlessssh">How to set up ssh so you aren’t asked for a password</a></p>
            
            <p>Add the contents of the public key file into ~/.ssh/authorized_keys on
            the remote site (the file should be mode 600).</p>
            
            <h3 id="make-user-a-sudoer">make user a sudoer</h3>
            
            <pre><code>
            pika# apt-get install sudo
            pika# adduser craig sudo
            </code></pre>
            
            <h2 id="install-compiler-tools">Install Compiler tools</h2>
            
            <pre><code>
            pika# apt-get install build-essential checkinstall libtool automake uuid-dev
             ...
            The following NEW packages will be installed:
              autoconf automake autotools-dev binutils build-essential bzip2 checkinstall cpp cpp-4.6 dpkg-dev fakeroot g++ g++-4.6 gcc gcc-4.6 gcc-4.6-base libalgorithm-diff-perl libalgorithm-diff-xs-perl libalgorithm-merge-perl libc-dev-bin
              libc6-dev libdpkg-perl libfile-fcntllock-perl libgmp10 libgomp1 libltdl-dev libltdl7 libmpc2 libmpfr4 libstdc++6-4.6-dev libtimedate-perl libtool linux-libc-dev m4 make manpages manpages-dev uuid-dev xz-utils
             ...
            </code></pre>
            
            <h3 id="zeromq-build-and-install">Zeromq build and install</h3>
            
            <p><a href="http://download.zeromq.org/zeromq-3.2.4.tar.gz">Source for stable release 3.2.4</a></p>
            
            <p>This is supported by ffi-rzmq, the JRuby library I plan to use.
            I unpacked for build at:</p>
            
            <pre><code>
            pika# cd /opt/zeromq/zeromq-3.2.4
            </code></pre>
            
            <p>The installation will be to /usr/local/</p>
            
            <pre><code>
            pika# ./configure --help
            Installation directories:
              --prefix=PREFIX         install architecture-independent files in PREFIX
                                      [/usr/local]
              --exec-prefix=EPREFIX   install architecture-dependent files in EPREFIX
                                      [PREFIX]
            </code></pre>
            
            <pre><code>
            pika# ./configure
            pika# make
            pika# checkinstall
            </code></pre>
            
            <p>A debian package was left here:</p>
            
            <pre><code>
            /opt/zeromq/zeromq-3.2.4/zeromq_3.2.4-1_armhf.deb
            </code></pre>
            
            <h2 id="install-supervisor-with-python-pip">Install supervisor with python-pip</h2>
            
            <pre><code>
            pika# apt-get install python-pip
             ...
            The following NEW packages will be installed:
              python-pip python-pkg-resources python-setuptools python2.6 python2.6-minimal
             ...
            
            pika# pip install supervisor
             ...
              Downloading supervisor-3.0.tar.gz (459Kb): 459Kb downloaded
             ...
                Installing echo_supervisord_conf script to /usr/local/bin
                Installing pidproxy script to /usr/local/bin
                Installing supervisorctl script to /usr/local/bin
                Installing supervisord script to /usr/local/bin
             ...
            </code></pre>
            
            <p>install python-pip mentioned apt-utils not installed, so let’s install it.</p>
            
            <pre><code>
            pika# apt-get install apt-utils
             ...
            The following NEW packages will be installed:
              apt-utils libapt-inst1.5
             ...
            </code></pre>
            
            <h3 id="install-socat">install socat</h3>
            
            <pre><code>
            pika# apt-get install socat
            </code></pre>
            
            <h3 id="install-oracle-jdk-8">Install Oracle jdk 8</h3>
            
            <p>extracted
            jdk-8-fcs-b129-linux-arm-vfp-hflt-06_feb_2014.tar.gz
            to /opt/java/jdk1.8.0</p>
            
            <p>Made a symbolic link for /opt/java/jdk</p>
            
            <pre><code>
            $ ls -l /opt/java/jdk
            lrwxrwxrwx 1 root root 9 Mar  5 22:06 /opt/java/jdk -&gt; jdk1.8.0/
            </code></pre>
            
            <h4 id="add-jdk-to-the-path">Add jdk to the path</h4>
            
            <ul>
              <li>/etc/profile</li>
              <li>/etc/sudoers</li>
              <li>/etc/environment</li>
              <li>/etc/login.defs</li>
            </ul>
            
            <p>Modify /etc/login.defs</p>
            
            <pre><code>
            ENV_SUPATH      PATH=/opt/java/jdk/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
            ENV_PATH        PATH=/opt/java/jdk/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
            </code></pre>
            
            <p>Modify /etc/profile</p>
            
            <pre><code>
            if [ "`id -u`" -eq 0 ]; then
              PATH="/opt/java/jdk/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"
            else
              PATH="/opt/java/jdk/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games"
            fi
            </code></pre>
            
            <p>modify /etc/sudoers</p>
            
            <pre><code>
            Defaults        secure_path="/opt/java/jdk/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"
            </code></pre>
            
            <p>/etc/environment was empty</p>
            
            <p>Verify that java runs and the version.</p>
            
            <pre><code>
            $ java -version
            java version "1.8.0"
            Java(TM) SE Runtime Environment (build 1.8.0-b129)
            Java HotSpot(TM) Client VM (build 25.0-b69, mixed mode)
            </code></pre>
            
            <h3 id="install-jruby">install jruby</h3>
            
            <p>Unpack the latest jruby tarball to
            /opt/jruby/jruby-1.7.11</p>
            
            <p>Make a symbolic to this version of jruby.</p>
            
            <pre><code>
            $ ls -l /opt/jruby/jruby
            lrwxrwxrwx 1 root root 13 Mar  5 23:06 /opt/jruby/jruby -&gt; jruby-1.7.11/
            </code></pre>
            
            <h4 id="modify-the-path-to-add-optjrubyjrubybin">modify the path to add /opt/jruby/jruby/bin</h4>
            
            <p>Modify /etc/login.defs</p>
            
            <pre><code>
            ENV_SUPATH      PATH=/opt/java/jdk/bin:/opt/jruby/jruby/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
            ENV_PATH        PATH=/opt/java/jdk/bin:/opt/jruby/jruby/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games
            </code></pre>
            
            <p>Modify /etc/profile</p>
            
            <pre><code>
            if [ "`id -u`" -eq 0 ]; then
              PATH="/opt/java/jdk/bin:/opt/jruby/jruby/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"
            else
              PATH="/opt/java/jdk/bin:/opt/jruby/jruby/bin:/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games"
            fi
            </code></pre>
            
            <p>modify /etc/sudoers</p>
            
            <pre><code>
            Defaults        secure_path="/opt/java/jdk/bin:/opt/jruby/jruby/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"
            </code></pre>
            
            <h4 id="define-javahome-in-the-environment">Define JAVA_HOME in the environment</h4>
            
            <p>Add to /etc/environment</p>
            
            <pre><code>
            JAVA_HOME=/opt/java/jdk
            </code></pre>
            
            <p>Verify that jruby runs.</p>
            
            <pre><code>
            $ jruby -v
            jruby 1.7.11 (1.9.3p392) 2014-02-24 86339bb on Java HotSpot(TM) Client VM 1.8.0-b129 +indy [linux-arm]
            </code></pre>
            
            <h4 id="change-permissions-in-jruby-folder-to-allow-user-craig-to-add-gems">Change permissions in jruby folder to allow user craig to add gems</h4>
            
            <pre><code>
            pika# adduser craig staff
            
            pika# cd /opt/jruby/jruby/lib/ruby/gems
            pika# find shared -type d |xargs chmod 775
            pika# find shared |xargs chmod g+w
            
            pika# cd /opt/jruby/jruby-1.7.11
            pika# find bin |xargs chmod g+w
            </code></pre>
            
            <h4 id="gem-install-bundler">gem install bundler</h4>
            
            <pre><code>
            $ gem install bundler
            Fetching: bundler-1.5.3.gem (100%)
            /opt/jruby/jruby-1.7.11/lib/ruby/shared/rubygems/installer.rb:507 warning: executable? does not in this environment and will return a dummy value
            Successfully installed bundler-1.5.3
            1 gem installed
            </code></pre>
            
            <h2 id="todo">todo</h2>
            
            <h3 id="done">done</h3>
            
            <ul>
              <li>serial console</li>
              <li>wifi setup</li>
              <li>password less ssh</li>
              <li>make user a sudoer</li>
              <li>checkinstall and compile tools</li>
              <li>zeromq compile and install</li>
              <li>supervisor</li>
              <li>socat</li>
              <li>Oracle JVM</li>
              <li>JRuby</li>
            </ul>
            
            <h3 id="todo-1">todo</h3>
            
            <ul>
              <li>fixed IP address</li>
              <li>JRuby/Reel test</li>
            </ul>
          </article>
        </div>
      </div>
    </div>
    <script src='/assets/app.js'></script>
  </body>
</html>

